name: Integration Test CI

on:
    push:
        branches: [master]
    pull_request:
        branches: [master, 'dependabot/*']

jobs:
    JavaScript:
        runs-on: ubuntu-latest
        env:
            APP: 'loading-icons-tester-js'
            WORKDIR: '/home/runner/work/react-loading-icons/react-loading-icons'

        steps:
            - uses: actions/checkout@v2
            - uses: actions/setup-node@v2-beta
              with:
                  node-version: '16'
                  check-latest: true

            - name: Create React App
              run: >-
                  npx create-react-app $APP &&
                  cd $APP &&
                  yarn add react-loading-icons

            - name: Build latest icons
              run: >-
                  cd $WORKDIR &&
                  yarn &&
                  yarn build &&
                  yarn link link

            - name: Build with latest icons
              run: >-
                  cd $APP &&
                  yarn link $WORKDIR &&
                  yarn &&
                  yarn build

    TypeScript:
        runs-on: ubuntu-latest
        env:
            APP: 'loading-icons-tester-ts'
            WORKDIR: '/home/runner/work/react-loading-icons/react-loading-icons'

        steps:
            - uses: actions/checkout@v2
            - uses: actions/setup-node@v2-beta
              with:
                  node-version: '16'
                  check-latest: true

            - name: Create React App
              run: >-
                  npx create-react-app $APP --template typescript &&
                  cd $APP &&
                  yarn add react-loading-icons

            - name: Build latest icons
              run: >-
                  cd $WORKDIR &&
                  yarn &&
                  yarn build &&
                  yarn link

            - name: Build app with latest icons
              run: >-
                  cd $APP &&
                  yarn link $WORKDIR &&
                  yarn &&
                  yarn build